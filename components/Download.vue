<template>
  <a :href="downloadUrl" class="button plausible-event-name=Download">
    <svg v-if="os === 'macos'" width="16px" height="16px" xmlns="http://www.w3.org/2000/svg" fill="none"
      viewBox="0 0 16 16">
      <path fill="#2F3031"
        d="M12.665 15.358c-.905.844-1.893.711-2.843.311-1.006-.409-1.93-.427-2.991 0-1.33.551-2.03.391-2.825-.31C-.498 10.886.166 4.078 5.28 3.83c1.246.062 2.114.657 2.843.71 1.09-.213 2.133-.826 3.296-.746 1.393.107 2.446.64 3.138 1.6-2.88 1.662-2.197 5.315.443 6.337-.526 1.333-1.21 2.657-2.345 3.635zM8.03 3.778C7.892 1.794 9.563.16 11.483 0c.268 2.293-2.16 4-3.452 3.777">
      </path>
    </svg>
    <svg v-if="os === 'windows'" width="16px" height="16px" viewBox="0 0 16 16" version="1.1"
      xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg">
      <g id="Windows 11">
        <path d="M0 9L7 9L7 16L0 16L0 9Z" id="Rectangle" fill="#2F3031" fill-rule="evenodd" stroke="none"
          clip-path="url(#clip_1)" />
        <path d="M9 9L16 9L16 16L9 16L9 9Z" id="Rectangle" fill="#2F3031" fill-rule="evenodd" stroke="none"
          clip-path="url(#clip_1)" />
        <path d="M9 0L16 0L16 7L9 7L9 0Z" id="Rectangle" fill="#2F3031" fill-rule="evenodd" stroke="none"
          clip-path="url(#clip_1)" />
        <path d="M0 0L7 0L7 7L0 7L0 0Z" id="Rectangle" fill="#2F3031" fill-rule="evenodd" stroke="none"
          clip-path="url(#clip_1)" />
      </g>
    </svg>
    <svg v-if="os === 'linux'" width="16px" height="16px" viewBox="0 0 16 16" version="1.1">
      <g id="Linux">
        <path d="M-13154 -6574L-13154 -6574L-13154 -6558L-13170 -6558L-13170 -6574L-13154 -6574Z" id="Linux" fill="none"
          stroke="none" />
        <path
          d="M2.56394 15.1392C3.40778 15.24 4.35589 15.7866 5.14934 15.8831C5.94705 15.9838 6.19391 15.3399 6.19391 15.3399C6.19391 15.3399 7.09159 15.1392 8.03533 15.1161C8.97999 15.0896 9.87421 15.3126 9.87421 15.3126C9.87421 15.3126 10.0476 15.7097 10.3713 15.8831C10.695 16.0599 11.392 16.0838 11.8387 15.6132C12.2862 15.1392 13.4803 14.5421 14.1507 14.1689C14.8255 13.7948 14.7016 13.2243 14.278 13.0509C13.8544 12.8775 13.5076 12.6042 13.5341 12.0797C13.5572 11.5596 13.16 11.2128 13.16 11.2128C13.16 11.2128 13.5076 10.0684 13.1839 9.1203C12.8602 8.17656 11.7926 6.65879 10.9718 5.51771C10.151 4.37323 10.8479 3.05194 10.1007 1.36335C9.35328 -0.327771 7.41535 -0.227809 6.37077 0.493003C5.3262 1.21387 5.64646 3.0015 5.69684 3.84965C5.74723 4.69349 5.7199 5.29732 5.6234 5.51431C5.52689 5.73465 4.85301 6.53496 4.40547 7.20543C3.95879 7.87931 3.63503 9.27065 3.30792 9.84462C2.98761 10.4152 3.21141 10.9353 3.21141 10.9353C3.21141 10.9353 2.98766 11.0122 2.81085 11.3863C2.63744 11.7561 2.29067 11.9329 1.66632 12.0534C1.04623 12.1806 1.04623 12.5804 1.19572 13.0279C1.34601 13.4746 1.19572 13.7248 1.02231 14.2954C0.848945 14.8659 1.7167 15.0392 2.56394 15.1392L2.56394 15.1392ZM11.3356 12.5367C11.7789 12.7306 12.416 12.4606 12.6099 12.2668C12.803 12.0737 12.9396 11.7868 12.9396 11.7868C12.9396 11.7868 13.1335 11.8833 13.1138 12.1899C13.0933 12.5008 13.2471 12.944 13.5374 13.0978C13.8278 13.2507 14.2711 13.4642 14.0414 13.6777C13.8073 13.8912 12.5125 14.4122 12.1256 14.8188C11.7421 15.2227 11.2382 15.5533 10.9316 15.4559C10.6216 15.3594 10.3508 14.9358 10.4841 14.3157C10.6216 13.6982 10.7378 13.0209 10.7181 12.634C10.6976 12.2471 10.6216 11.7261 10.7181 11.6492C10.8146 11.5732 10.9684 11.6099 10.9684 11.6099C10.9684 11.6099 10.8914 12.3437 11.3356 12.5367L11.3356 12.5367ZM8.459 2.08421C8.88602 2.08421 9.23025 2.50783 9.23025 3.02882C9.23025 3.39865 9.05684 3.71896 8.80318 3.87271C8.73913 3.84624 8.67249 3.81633 8.59904 3.78555C8.75279 3.70956 8.85951 3.51568 8.85951 3.29188C8.85951 2.99896 8.67934 2.75809 8.45296 2.75809C8.23261 2.75809 8.04894 2.9989 8.04894 3.29188C8.04894 3.3987 8.07546 3.50542 8.11899 3.58913C7.98576 3.53529 7.86532 3.48922 7.76882 3.45249C7.71843 3.3252 7.68851 3.18171 7.68851 3.02887C7.68856 2.50788 8.03188 2.08421 8.459 2.08421L8.459 2.08421ZM7.40158 3.71215C7.61171 3.74887 8.18903 3.99913 8.40262 4.07598C8.61616 4.14943 8.8527 4.28607 8.82964 4.42275C8.80318 4.56365 8.69301 4.56365 8.40262 4.74047C8.11563 4.91387 7.48874 5.30077 7.288 5.32723C7.08813 5.3537 6.97456 5.24093 6.76097 5.10344C6.54743 4.96335 6.14692 4.63624 6.24765 4.46288C6.24765 4.46288 6.5611 4.22288 6.69778 4.09991C6.83447 3.97262 7.18804 3.67283 7.40158 3.71215L7.40158 3.71215ZM6.48084 2.23456C6.81735 2.23456 7.09153 2.63512 7.09153 3.12878C7.09153 3.21849 7.08127 3.30214 7.06507 3.38585C6.98136 3.41231 6.8977 3.45589 6.81735 3.52594C6.77809 3.55926 6.74131 3.58913 6.70804 3.62245C6.76097 3.52254 6.78149 3.37904 6.75757 3.22869C6.71144 2.96223 6.53123 2.76495 6.35442 2.79141C6.17674 2.82133 6.07084 3.0656 6.11355 3.33551C6.16054 3.60883 6.3373 3.80607 6.51752 3.7762C6.52777 3.7728 6.53717 3.76939 6.54743 3.76594C6.46118 3.84965 6.38088 3.92309 6.29717 3.98288C6.05377 3.86925 5.87355 3.52934 5.87355 3.12878C5.8736 2.63172 6.14347 2.23456 6.48084 2.23456L6.48084 2.23456ZM4.6061 8.69668C4.95287 8.15009 5.17661 6.95517 5.52338 6.55802C5.8736 6.16172 6.14347 5.31703 6.0205 4.94379C6.0205 4.94379 6.76783 5.83802 7.288 5.69112C7.80899 5.54077 8.97999 4.67047 9.15335 4.81996C9.32676 4.97026 10.818 8.25 10.9683 9.29457C11.1187 10.3383 10.8684 11.136 10.8684 11.136C10.8684 11.136 10.2979 10.9857 10.2244 11.3325C10.1509 11.6826 10.1509 12.951 10.1509 12.951C10.1509 12.951 9.37968 14.0186 8.18563 14.1954C6.99157 14.3688 6.39368 14.2424 6.39368 14.2424L5.7232 13.4745C5.7232 13.4745 6.24424 13.3977 6.17074 12.8741C6.0973 12.354 4.57867 11.6331 4.30535 10.9856C4.03213 10.3382 4.25506 9.24413 4.6061 8.69668L4.6061 8.69668ZM1.65347 12.6136C1.71325 12.3574 2.48704 12.3574 2.78428 12.1772C3.08153 11.9969 3.14126 11.4794 3.38131 11.3427C3.61786 11.2026 4.05519 11.6998 4.23541 11.9798C4.41222 12.2531 5.08955 13.4481 5.36628 13.7453C5.6464 14.045 5.90352 14.4422 5.82322 14.7992C5.74723 15.1562 5.32615 15.4167 5.32615 15.4167C4.94952 15.5329 3.89895 15.0794 3.42154 14.8795C2.94413 14.6788 1.72956 14.619 1.57326 14.4422C1.4127 14.262 1.65011 13.8648 1.7133 13.4881C1.76963 13.1072 1.59287 12.8706 1.65347 12.6136L1.65347 12.6136Z"
          id="Shape" fill="#2F3031" fill-rule="evenodd" stroke="none" clip-path="url(#clip_1)" />
      </g>
    </svg>
    Download
  </a>
</template>

<script setup>
import { ref } from 'vue';
import { useRequestHeaders } from '#app';
import { useAsyncData } from '#app';

const downloadUrl = ref('');
const os = ref('linux');
const headers = useRequestHeaders(['user-agent']);
const userAgent = headers['user-agent'] || (typeof window !== 'undefined' ? window.navigator.userAgent : '');

const fetchData = async () => {
  const storedData = useState('latestData', () => null);
  if (storedData.value) {
    downloadUrl.value = storedData.value.version_link;
  } else {
    const { data } = await useAsyncData('latest', () => $fetch('/api/latest'));
    downloadUrl.value = data.value.version_link;
    storedData.value = data.value;
  }
};

await fetchData();

if (userAgent) {
  const ua = userAgent.toLowerCase();
  if (ua.includes('mac')) os.value = 'macos';
  else if (ua.includes('win')) os.value = 'windows';
  else if (ua.includes('linux')) os.value = 'linux';
}
</script>

<style scoped>
.button {
  text-decoration: none;
  display: flex;
  flex-direction: row;
  background-color: #E6E6E6;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding-inline: 14px;
  color: #2F3031;
  font-size: 14px;
  font-weight: 600;
  border-radius: 8px;
  height: 36px;
  cursor: pointer;
  transition: all .2s ease-in-out;
  width: min-content;
}

.button:hover {
  background-color: white;
  transition: all .2s ease-in-out;
}
</style>
